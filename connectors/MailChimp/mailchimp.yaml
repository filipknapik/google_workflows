MESSAGE='{"key": "$YOUR_API_KEY", "message": 
{"from_email": "hello@example.com", "subject": "Hello World", 
"text": "Welcome to Mailchimp Transactional!", 
"to": [{ "email": "freddie@example.com", "type": "to" }]}}'

curl -sS -X POST "https://mandrillapp.com/api/1.0/messages/send" --header 'Content-Type: application/json' --data-raw "$MESSAGE"

sendMailChimp:
    params: [secret, from, to, subject, content, contentType]
    steps:
    - getSecret:
        call: http.get
        args:
            url: ${"https://secretmanager.googleapis.com/v1/projects/" + sys.get_env("GOOGLE_CLOUD_PROJECT_NUMBER") + "/secrets/" + secret + "/versions/latest:access"}
            auth:
                type: OAuth2
        result: sendGridKey
    - decodeSecrets:
        assign:
        - decodedKey: ${text.decode(base64.decode(sendGridKey.body.payload.data))}
    - sendMessage:
        call: http.post
        args:
            url: https://api.sendgrid.com/v3/mail/send
            headers:
                Content-Type: "application/json"
                Authorization: ${"Bearer " + decodedKey }
            body:
                personalizations:
                - to:
                    - email: ${to}
                from:
                    email: ${from}
                subject: ${subject}
                content:
                - type: ${contentType}
                  value: ${content}
        result: sendGridResult
    - returnValue:
        return: ${sendGridResult}